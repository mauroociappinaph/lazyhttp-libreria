"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cacheFirst=cacheFirst,exports.networkFirst=networkFirst,exports.staleWhileRevalidate=staleWhileRevalidate,exports.networkOnly=networkOnly,exports.cacheOnly=cacheOnly,exports.executeWithCacheStrategy=executeWithCacheStrategy;const tslib_1=require("tslib"),cache=tslib_1.__importStar(require("./http-cache"));async function cacheFirst(e,t,r){const a=cache.get(e);if(a)return a;try{const a=await t();return a.error||cache.set(e,a,r),a}catch(e){return{data:null,error:`Error obteniendo datos: ${e instanceof Error?e.message:String(e)}`,status:0}}}async function networkFirst(e,t,r){try{const a=await t();return a.error||cache.set(e,a,r),a}catch(t){const r=cache.get(e);return r?{...r,meta:{...r.meta||{},fromCache:!0,networkError:String(t)}}:{data:null,error:`Error obteniendo datos: ${t instanceof Error?t.message:String(t)}`,status:0}}}async function staleWhileRevalidate(e,t,r){const a=cache.get(e);if(a)return(async()=>{try{const a=await t();a.error||cache.set(e,a,r)}catch(e){console.warn(`Error actualizando caché: ${e}`)}})(),{...a,meta:{...a.meta||{},fromCache:!0,refreshing:!0}};try{const a=await t();return a.error||cache.set(e,a,r),a}catch(e){return{data:null,error:`Error obteniendo datos: ${e instanceof Error?e.message:String(e)}`,status:0}}}async function networkOnly(e,t,r){try{const a=await t();return a.error||!1===(null==r?void 0:r.enabled)||cache.set(e,a,r),a}catch(e){return{data:null,error:`Error obteniendo datos: ${e instanceof Error?e.message:String(e)}`,status:0}}}async function cacheOnly(e){const t=cache.get(e);return t||{data:null,error:"No hay datos en caché",status:404}}async function executeWithCacheStrategy(e,t,r){switch(cache.getStrategy(r)){case"cache-first":default:return cacheFirst(e,t,null==r?void 0:r.cache);case"network-first":return networkFirst(e,t,null==r?void 0:r.cache);case"stale-while-revalidate":return staleWhileRevalidate(e,t,null==r?void 0:r.cache);case"network-only":return networkOnly(e,t,null==r?void 0:r.cache);case"cache-only":return cacheOnly(e)}}