#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Ejecutando verificaciones pre-push con Husky..."
echo "Este proceso es mÃ¡s exhaustivo y puede tardar unos minutos."

# 1. Ejecutar la suite de pruebas completa (unitarias y de integraciÃ³n)
echo "ğŸ§ª Ejecutando la suite de pruebas completa..."
pnpm test:ci
if [ $? -ne 0 ]; then
  echo "â›” Las pruebas completas fallaron. Revisa los errores antes de hacer push."
  exit 1
fi

# 2. VerificaciÃ³n de seguridad estricta sobre dependencias de producciÃ³n
echo "ğŸ”’ Realizando una auditorÃ­a de seguridad de producciÃ³n..."
pnpm audit --prod
if [ $? -ne 0 ]; then
  echo "â›” Se encontraron vulnerabilidades de seguridad de producciÃ³n. ArrÃ©glalas antes de hacer push."
  exit 1
fi

echo "âœ… Todas las verificaciones pre-push pasaron. Â¡Push autorizado!"